{% extends 'base.html' %}
{% block styles %}
{{ super() }}
{% endblock %}
{% block scripts %}
<script>
    document.querySelectorAll('.day-link').forEach(function(link) {
        link.addEventListener('click', function(event) {
            event.preventDefault(); 
            
            var newDay = link.textContent.trim();
            
            document.querySelector('h1').textContent = 'Événements du festival pour le ' + newDay;
            
            var xhr = new XMLHttpRequest();
            xhr.open('GET', link.href, true);

            xhr.onload = function() {
                if (xhr.status >= 200 && xhr.status < 400) {
                    document.querySelector('.events-container').innerHTML = xhr.responseText;
                }
            };

            xhr.send();
        });
    });
</script>
{% endblock %}

{% block main %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/day_detail.css')}}">

    <h1>{{ festival.nomFestival }}</h1>
    <a class="acheterBillet" href="{{ url_for('billeterie', idFestival=festival.idFestival) }}">Acheter un billet</a>
    <h2>Événements du festival pour le {{ day }}</h2>

    <div class="days-container">
        {% for event_day in events_by_day %}
            {% if event_day != day %}
                <a class="day" href="{{ url_for('day_detail', festival_id=festival.idFestival, day=event_day.strftime('%Y-%m-%d')) }}" class="day-link">{{ event_day.strftime('%Y-%m-%d') }}</a>
            {% endif %}
        {% endfor %}
    </div>
    <div class="affichageDetail">
        {% for event in events_for_day %}
    <div class="event">
        <div class="evt" href="#">
            <p><strong>Nom de l'évènement</strong> : {{ event.nomEvent }}</p>
            <p><strong>Type d'évènement</strong> : {{ event.typeEvent }}</p>
            <p><strong>Date de l'évènement</strong> : {{ event.dateHeureDebutEvent | datetime_format }} - {{ event.dateHeureFinEvent | datetime_format('%Hh:%M') }}</p>
            
            <p><strong>Nombre de place disponible</strong> : {{ event.reservations|lenght }} / {{ event.nbPlaceEvent if event.nbPlaceEvent > 0 else "illimité" }}</p>
            <p><strong>Adresse de l'évènement</strong> : {{ event.adresseEvent }}</p>
            <form class="gratuitPayant" action="{{ url_for('reserver', idEvent=event.idEvent) }}" method="POST">
                <button type="submit">Réserver</button>
                <input type="number" name="quantite" id="quantite" value="1" min="1"  max="{{ event.nbPlaceEvent-event.reservations|lenght if event.nbPlaceEvent > 0 else 10 }}" required>
            </form>
            {% endif %}
            {{ event.imageEvent | byte_to_image | safe }}
        </div>
        {% if event.estGratuit %}
        <a class="reserver" href="{{ url_for('reserver', idEvent=event.idEvent) }}">Réserver</a>
        {%else %}
        <p class="indisponnible">Non réservable</p>
        {% endif %}
    </div>
    
    {% endfor %}
    </div>   
{% endblock %}
